<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Vim Tips: Macros | Al Idian</title>

    <meta name="description" content="A personal site about software development">

    <link rel="preconnect" href="https://fonts.gstatic.com"> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&amp;family=Merriweather&amp;display=swap">

    <link rel="stylesheet" href="/css/syntax-highlight.css">
    <link rel="stylesheet" href="/css/style.css">

    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
</head>
<body>
    <header>
        <h3 id="site-title" class="no-margin no-padding"><a href="/">Al Idian</a></h3>
    </header>

    <main>
        
<h1 id="post-title">Vim Tips: Macros</h1>
<p id="post-date" class="gray-text">2021.02.15</p>

<p>While Vim’s dot operator allows us to repeat very small chunks of work, Vim macros are the full-fat version. Macros require more work to manage and invoke compared to the dot operator but are many times more powerful and flexible. Like the dot operator, the main benefit of macros is its ability reduce repetition by recording and replaying chunks of work.</p>
<p>Invoking the dot operator is simple; like its name suggests, you simply type <code>.</code> in normal mode, repeating the last action. Macros require you to explicitly start recording a chunk of work, which can be composed of many actions. These actions are recorded and invoked under one of the 26 letters of the English alphabet.</p>
<p>To start recording a macro, simply type <code>q&lt;a-z&gt;</code>, where the letter following <code>q</code> serves as the key used to refer to the macro. You should see an indicator near the bottom of Vim’s UI indicating that you are currently recording a macro, along with the key you selected. You would then perform the actions to be recorded as part of the macro, making sure that the actions are <em>repeatable</em> across the different sections you intend to run your macro on. To stop recording, press <code>q</code> once again.</p>
<p>To invoke a Macro, type <code>q&lt;a-z&gt;&lt;CR&gt;</code>, where the letter following <code>q</code> is the key you selected and <CR> is the carriage return key.</p>
<p>Let me illustrate with an example. Suppose we had the following list of ids, and we want to enclose each one in double-quotes and append a comma after each line:</p>
<pre class="language-text"><code class="language-text"><span class="highlight-line">13454373</span><br><span class="highlight-line">46543422</span><br><span class="highlight-line">6544443</span><br><span class="highlight-line">23432232</span><br><span class="highlight-line">89007</span></code></pre>
<p>This scenario is very similar to the one I presented in my previous <a href="/posts/2021/vim-tips-the-dot-operator/">post</a> on the dot operator. Unlike the previous version, this one is slightly more complex where the change required in each line is composed of several actions.</p>
<p>To perform said change on each of the lines above, we record a macro and do the work for the first line. While positioned somewhere in the first line, do the following:</p>
<ol>
<li>Type <code>qq</code> which begins the recording under the letter <code>q</code>.</li>
<li>Type <code>0de</code> taking the cursor to the beginning the line and deleting until the end of the line.</li>
<li>Type <code>i&quot;&quot;,&lt;ESC&gt;</code> inserting the double-quotes and the comma and then going back to normal mode.</li>
<li>Type <code>F&quot;P</code> noting that <code>F</code> and <code>P</code> are uppercase. This brings the cursor back to the second double-quote and pastes the contents of the line deleted in step 2.</li>
<li>Type <code>j</code> moving down to the next line (if available).</li>
<li>Type <code>q</code> which stops the recording.</li>
</ol>
<p>At this point, we have successfully recorded the macro we want to run for each subsequent line. We can move on the next line (anywhere will do) and invoke the macro by typing <code>@q</code>. This will run the macro once on the current line.</p>
<p>We don’t want to retype <code>@q</code> for each of the other lines so instead we can type <code>3@q</code> which means invoke this macro three times sequentially. It is important to note that what allows us to do this is that we made our macro <em>repeatable</em> even when done sequentially.</p>
<p>Specifically, here are the features built into the macro that made it repeatable across different lines:</p>
<ul>
<li>Prepending the deletion in step 2 with <code>0</code> makes it so it does not matter where we start off on the line.</li>
<li>Using word-wise movements, like <code>e</code>, rather than single character movements makes the macro resilient to little variations across the ids (i.e. the length of the ids).</li>
<li>Step 4 moves our position to the next line, making it possible to invoke the macro back-to-back.</li>
</ul>
<p>Macros are an important tool that can drastically improve productivity and reduce repetition. Like the dot operator, they take a bit of foresight and creative thinking to use successfully.</p>

    </main>

    <footer>
        <p class="center-text no-margin no-padding"><a href="https://github.com/octos4murai/personal-site/blob/master/LICENSE">MIT License</a></p>
        <p class="center-text no-margin no-padding"><a href="https://github.com/octos4murai/personal-site">/octos4murai</a></p>
    </footer>
</body>
</html>