<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Setting Up a Home Server | Al Idian</title>

    <meta name="description" content="A personal site about software development">

    <link rel="preconnect" href="https://fonts.gstatic.com"> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&amp;family=Merriweather&amp;display=swap">

    <link rel="stylesheet" href="/css/syntax-highlight.css">
    <link rel="stylesheet" href="/css/style.css">

    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
</head>
<body>
    <header>
        <h3 id="site-title" class="no-margin no-padding"><a href="/">Al Idian</a></h3>
    </header>

    <main>
        
<h1 id="post-title">Setting Up a Home Server</h1>
<p id="post-date" class="gray-text">2021.03.07</p>

<h3>Background</h3>
<p>Recently, I purchased a <a href="https://www.intel.com/content/www/us/en/products/boards-kits/nuc/kits.html">NUC barebones kit</a>, which I customized with some memory and storage. Assembling the adorable, little computer was easy and quite fun — and so was selecting and installing a Linux distro. It is strange to think this is actually the first desktop computer I have personally owned.</p>
<p>I wanted to use the computer as a moderately-powerful Linux development machine, and while I am experienced at working with Linux through remote connections and containers, I have never used Linux on my primary machine before.</p>
<p>Aside from serving as my primary computer, I wanted the NUC to function as a remote development machine — something I can <code>ssh</code> into from my MacBook when I am away from home. In this blog post, I wanted to write about how I was able to successfully set up the NUC as a home server for development and general computing.</p>
<h3>Requirements</h3>
<p>Here is what I wanted to achieve:</p>
<ol>
<li>Have the ability to work on the NUC remotely through <code>ssh</code>, and</li>
<li>Do the above while on a residential internet connection with a dynamic IP address.</li>
</ol>
<h3>Creating the SSH Server</h3>
<p>The first step is simple to achieve. On my machine using <a href="https://pop.system76.com/">Pop!_OS</a>, I ran:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> openssh-server</code></pre>
<p>Since Pop!_OS is based on Ubuntu/Debian, the same command will work for Ubuntu, Debian, and other distros in the same family.</p>
<p>Even before any configuration, installing <code>openssh-server</code> is enough to support incoming <code>ssh</code> connections within the local network. So at this point, I am able to connect locally to my NUC from my MacBook through the NUC’s local IP address.</p>
<h3>Working Around a Dynamic IP Address</h3>
<p>The second step is a lot more involved than the first. There are a couple distinct challenges here:</p>
<ol>
<li>Since my residential internet connection has a dynamic IP address, I can’t rely on my home’s public IP address to remain consistent over any period of time. I would like a solution that automatically handles this whenever it happens.</li>
<li>When I try to initiate an <code>ssh</code> connection from an outside device to my home network, my router needs to know to relay the information to my NUC.</li>
</ol>
<p>To solve the first challenge and after a bit of research, I did the following:</p>
<ul>
<li>Signed up for a free Dynamic DNS service (i.e. <a href="https://www.noip.com/">No-IP</a>). This service provides me a subdomain under one of their many domains (e.g. foobar.noip.com). It then maps my home network’s current public IP address to that subdomain. As a result, whenever I want to initiate a connection with my home network from an outside device, I don’t have to know the IP. I can just connect to the assigned subdomain <code>foobar.noip.com</code>; this subdomain is effectively an alias for my home network’s IP address.</li>
<li>Set up <a href="https://support.google.com/domains/answer/6147083?hl=en">Dynamic DNS</a> on my router. When the home network’s IP inevitably changes, a job is invoked to give No-IP the updated value. The IP mapped to the subdomain <code>foobar.noip.com</code> is changed to reflect this.</li>
</ul>
<p>Then to deal with the second challenge, I did the following:</p>
<ul>
<li>Configured my router to use Port Forwarding, allowing me to reserve a port for a specific local IP address. In effect, anything trying to connect to my home network through a predetermined port is connected to my home server through its local IP address.</li>
<li>Since <a href="https://en.wikipedia.org/wiki/Port_forwarding">Port Forwarding</a> uses the local IP to send data to my NUC, I need to make sure my device’s local IP stays the same. To achieve this, I added an entry in my router’s <a href="https://homenetworkadmin.com/dhcp-reservation/">DHCP Reservation</a> list which permanently allocates an address to my NUC (using the MAC address).</li>
</ul>
<p>By using a free third-party service and making configuration changes to my home router, I was able to guarantee a reliable way to connect to my home server through <code>ssh</code> from an outside device.</p>
<h3>Additional Security</h3>
<p>Since I have opened up my home network to incoming traffic from the public Internet, it is crucial that I think about what security features I can put up to minimize my attack surface. Here is what I have done so far:</p>
<ul>
<li>Configured my router to block all incoming connections except for specific ports (and specific types of connections),</li>
<li>Set up <code>ufw</code> on my home server to only accept incoming traffic that is <code>ssh</code>,</li>
</ul>
<pre class="language-bash"><code class="language-bash"><span class="token function">sudo</span> ufw allow <span class="token function">ssh</span><br><span class="token function">sudo</span> ufw <span class="token builtin class-name">enable</span></code></pre>
<ul>
<li>Since I will be exclusively using my MacBook to <code>ssh</code> to my NUC, I set up the two machines to authenticate using <code>ssh</code> tokens. This also means I can disallow password authentication (by editing <code>/etc/ssh/sshd_config</code>). To get <code>ssh</code> access to my home server, you need to be making the connection using my MacBook.</li>
</ul>

    </main>

    <footer>
        <p class="center-text no-margin no-padding"><a href="https://github.com/octos4murai/personal-site/blob/master/LICENSE">MIT License</a></p>
        <p class="center-text no-margin no-padding"><a href="https://github.com/octos4murai/personal-site">/octos4murai</a></p>
    </footer>
</body>
</html>
