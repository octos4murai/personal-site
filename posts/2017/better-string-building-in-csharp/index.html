<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Better String Building in C# | Al Idian</title>

    <meta name="description" content="A personal site about software development">

    <link rel="preconnect" href="https://fonts.gstatic.com"> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&amp;family=Merriweather&amp;display=swap">

    <link rel="stylesheet" href="/css/syntax-highlight.css">
    <link rel="stylesheet" href="/css/style.css">

    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
</head>
<body>
    <header>
        <h3 id="site-title" class="no-margin no-padding"><a href="/">Al Idian</a></h3>
    </header>

    <main>
        
<h1 id="post-title">Better String Building in C#</h1>
<p id="post-date" class="gray-text">2017.06.12</p>

<h3>Strings in C#</h3>
<p>Unlike strings in C which are nothing more than <em>char</em> arrays, strings in C# are represented as objects of the <em>String</em> class. At the heart of the <em>String</em> class resides a <em>char</em> array, not unlike strings in C.</p>
<p>Aside from the <em>char</em> array and a host of methods and constructors, the <em>String</em> class also keeps a <em>Length</em> property which contains the length of the <em>char</em> array. To get the length of a string in C, one would need to iterate through the entire array while incrementing a counter. This takes O(n). In C#, the Length property is always available and so retrieving a string’s length is O(1).</p>
<p>Modifying a string in C is as simple as modifying the corresponding element/s of the <em>char</em> array. In C# however, strings are immutable — they can never be modified once instantiated. Instead, a new string is created every time a change is made, an expensive operation.</p>
<p>Examine the code below as an example of this sub-optimal operation. Then have a look further below for a better alternative, making use of the <em>StringBuilder</em> class.</p>
<h3>The common way</h3>
<pre class="language-csharp"><code class="language-csharp"><span class="token comment">// A</span><br><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> stringArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"This"</span><span class="token punctuation">,</span> <span class="token string">"is"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"string"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token class-name"><span class="token keyword">string</span></span> returnString <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span><br><br><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> stringArray<span class="token punctuation">.</span>Length<span class="token punctuation">,</span> i<span class="token operator">++</span><span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    returnString <span class="token operator">+=</span> stringArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>Console<span class="token punctuation">.</span><span class="token function">Writeline</span><span class="token punctuation">(</span>returnString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "This is a string"</span></code></pre>
<p>This is a very common way to build a string but it is also highly inefficient. Each time the string is modified inside the <em>foreach</em> loop, a new string must necessarily be created.</p>
<p>Here is a snippet that demonstrates what takes place internally:</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token comment">// A (Internal)</span><br><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> stringArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"This"</span><span class="token punctuation">,</span> <span class="token string">"is"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"string"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token class-name"><span class="token keyword">string</span></span> returnString <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span><br><br><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> stringArray<span class="token punctuation">.</span>Length<span class="token punctuation">,</span> i<span class="token operator">++</span><span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    <span class="token class-name">StringBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    builder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>returnString<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    builder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>stringArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    builder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    returnString <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>Console<span class="token punctuation">.</span><span class="token function">Writeline</span><span class="token punctuation">(</span>returnString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "This is a string"</span></code></pre>
<p>At each iteration, a new object is instantiated, and its string representation returned.</p>
<p>You may have noticed I used a class <em>StringBuilder</em>, which seems to be able to mutate strings through the method <em>Append()</em>. Couldn’t that class be used to create the string instead of the <em>String</em> class? Yes, it can; this leads us to our alternative…</p>
<h3>A better way</h3>
<p>Like <em>String</em>, <em>StringBuilder</em> is a class that represents a string. Unlike <em>String</em> however, <em>StringBuilder</em> is used explicitly for — <em>pause for effect</em> — building strings. <em>StringBuilder</em> is mutable, which means a new object need not be created at each iteration of our code.</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token comment">// B</span><br><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> stringArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"This"</span><span class="token punctuation">,</span> <span class="token string">"is"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"string"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token class-name">StringBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> stringArray<span class="token punctuation">.</span>Length<span class="token punctuation">,</span> i<span class="token operator">++</span><span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    builder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>stringArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    builder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>Console<span class="token punctuation">.</span><span class="token function">Writeline</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints "This is a string"</span></code></pre>
<h3>TL/DR</h3>
<p>When writing code that appends to a string many times (probably through a loop), consider using the <em>StringBuilder</em> class which is more performant at this task than the <em>String</em> class.</p>

    </main>

    <footer>
        <p class="center-text no-margin no-padding"><a href="https://github.com/octos4murai/personal-site/blob/master/LICENSE">MIT License</a></p>
        <p class="center-text no-margin no-padding"><a href="https://github.com/octos4murai/personal-site">/octos4murai</a></p>
    </footer>
</body>
</html>
